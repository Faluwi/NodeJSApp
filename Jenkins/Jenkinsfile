appName = "hello-world"

pipeline {
    // Use the 'node' Jenkins agent image which is provided with OpenShift 
    agent {label 'nodejs'}
    stages {
        stage("Clean bc") {
            steps {
                sh 'oc delete bc hello-world'
            }
        }
        //stage("buildconnfig") {
         //   steps {
               //sh 'oc create -f ./Templates/buildconfig.yaml'
         //   }
        //}
        stage("Checkout") {
            steps {
                checkout scm
            }
        }
        stage("Testing") {
            steps {
                sh "echo 'Testing'"
            }
        }
        stage("Docker Build") {
            steps {
                sh 'oc create -f ./Templates/buildconfig.yaml'
                sh "oc start-build hello-world --from-dir '.'"
                // This uploads your application's source code and performs a binary build in OpenShift
                // This is a step defined in the shared library (see the top for the URL)
                // (Or you could invoke this step using 'oc' commands!)
                //binaryBuild(buildConfigName: appName, buildFromPath: ".")
            }
        }
        stage ("Deploy to DEV") {
            steps {
                sh 'oc delete deployment test'
                sh 'oc delete service test'
                sh "oc new-app faluwi/test:latest"
            }
        }
        
        stage ("helm") {
            agent {
                kubernetes {
                    yaml '''
                        apiVersion: v1
                        kind: Pod
                        spec:
                            containers:
                            -  name: helm-slave
                               image: docker.io/faluwi/jenkins-helm-agent:v0.1
                               command:
                               - cat
                               tty: true
                        '''
                }
            }
              steps {
                  sh 'echo "hellM"'
             }
        }
    }//Stages
}//Pipeline
